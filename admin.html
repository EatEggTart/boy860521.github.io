<!DOCTYPE html>
<html>
    <head>
        <title>Admin</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="deafult.css" rel="stylesheet" type="text/css" media="screen">
    </head>
    <body>  
        <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
        <script> // Initialize Firebase
            var config = {
                apiKey: "AIzaSyAC89iT0646zdcQdSE-Cv6gFYVvNjVO3pU",
                authDomain: "smallmonster-fdf5b.firebaseapp.com",
                databaseURL: "https://smallmonster-fdf5b.firebaseio.com",
                projectId: "smallmonster-fdf5b",
                storageBucket: "smallmonster-fdf5b.appspot.com",
                messagingSenderId: "139238440125"
            };
            firebase.initializeApp(config);
        </script>
        <script>
            var user;
            if(sessionStorage.getItem("loggedInUser")){
                        document.getElementById("login").style.display = "none";
                        document.getElementById("name").style.display = "inline-block";
                        document.getElementById("gender").style.display = "inline-block";
                        document.getElementById("age").style.display = "inline-block";
                        document.getElementById("add").style.display = "inline-block";
                        document.getElementById("location").style.display = "inline-block";
                        document.getElementById("time").style.display = "inline-block";
                        document.getElementById("description").style.display = "inline-block";
                        document.getElementById("selectpicture").style.display = "inline-block";
                        document.getElementById("addpicture").style.display = "inline-block";
                        
                    }
            function adduser(){
                var name = document.getElementById("name");
                var gender = document.getElementById("gender");
                var age = document.getElementById("age");

                if(user == null){
                    window.alert("Please login to proceed.");
                }
                else if(name.value=='' || gender.value=='' || age.value==''){
                    window.alert("Name, genger, and age should not be empty");
                }
                else{
                    firebase.database().ref(user.uid + '/UsersData/' + name.value).set({
                        gender: gender.value,
                        age: age.value
                    });
                    name.value = '';
                    gender.value = '';
                    age.value = '';
                }
            }
            function login(){
                var provider = new firebase.auth.GoogleAuthProvider();
    
                firebase.auth().signInWithPopup(provider).then(function(result) {
                    // This gives you a Google Access Token. You can use it to access the Google API.
                    var token = result.credential.accessToken;
                    // The signed-in user info.
                    user = result.user;
                    if(user){
                        document.getElementById("login").style.display = "none";
                        document.getElementById("name").style.display = "inline-block";
                        document.getElementById("gender").style.display = "inline-block";
                        document.getElementById("age").style.display = "inline-block";
                        document.getElementById("add").style.display = "inline-block";
                        document.getElementById("location").style.display = "inline-block";
                        document.getElementById("time").style.display = "inline-block";
                        document.getElementById("description").style.display = "inline-block";
                        document.getElementById("selectpicture").style.display = "inline-block";
                        document.getElementById("addpicture").style.display = "inline-block";
                        sessionStorage.setItem("loggedInUser", user);
                    }
                }).catch(function(error) {
                // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // The email of the user's account used.
                    var email = error.email;
                    // The firebase.auth.AuthCredential type that was used.
                    var credential = error.credential;
                    // ...
                });
                user = firebase.auth().currentUser;
            }
            function addpicture(){
                var File = document.getElementById("file");

                var file = File.files[0];
                var storageRef = firebase.storage().ref(user.uid + '/abc/' + file.name);
                var task = storageRef.put(file);
            }
        </script>
        <br>
        <button id = "login" style="display: inline-block" onclick="login()">admin login</button>
        <table><tr>
            <th><input type="text" placeholder="name" id="name"></th>
            <th><input type="text" placeholder="gender" id="gender"></th>
            <th><input type="text" placeholder="age" id="age"></th>
        </tr></table>
        <button id = "add" onclick="adduser()">add user</button>
        
        <input type="text" placeholder="location" id="location" style="width: 70%;">
        <input type="text" placeholder="time to visit" id="time" style="width: 70%;">
        <input type="text" placeholder="description" id="description" style="width: 70%; height: 200px;">
        <input type="file" id="file" style="display: none;">
        <button id = "selectpicture"><label for="file">select picture</label></button>
        <button id = "addpicture" onclick="addpicture()">add picture</button>

    </body>
</html>
